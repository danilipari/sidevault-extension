{"version":3,"file":"background.ts-BiQG3gLg.js","sources":["../../src/background.ts"],"sourcesContent":["// SideVault Background Service Worker\n\n// Open side panel when extension icon is clicked\nchrome.action.onClicked.addListener(async (tab) => {\n  if (tab.id) {\n    await chrome.sidePanel.open({ tabId: tab.id })\n  }\n})\n\n// Handle messages from side panel\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  if (message.type === 'CAPTURE_SCREENSHOT') {\n    handleScreenshotCapture(message.tabId, message.options)\n      .then(result => sendResponse(result))\n      .catch(error => sendResponse({ success: false, error: error.message }))\n    return true // Keep channel open for async response\n  }\n\n  if (message.type === 'GET_CURRENT_TAB') {\n    getCurrentTab()\n      .then(tab => sendResponse({ success: true, tab }))\n      .catch(error => sendResponse({ success: false, error: error.message }))\n    return true\n  }\n\n  return false\n})\n\n// Handle keyboard shortcut for saving current page\nchrome.commands.onCommand.addListener(async (command) => {\n  if (command === 'save_current_page') {\n    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true })\n    if (tab?.id) {\n      // Open side panel and send save command\n      await chrome.sidePanel.open({ tabId: tab.id })\n      // Small delay to ensure panel is ready\n      setTimeout(() => {\n        chrome.runtime.sendMessage({ type: 'TRIGGER_SAVE', tab })\n      }, 300)\n    }\n  }\n})\n\nasync function handleScreenshotCapture(\n  tabId: number,\n  options: { quality?: number; format?: 'jpeg' | 'png' }\n): Promise<{ success: boolean; dataUrl?: string; error?: string }> {\n  try {\n    const tab = await chrome.tabs.get(tabId)\n    if (!tab.windowId) {\n      throw new Error('Tab window not found')\n    }\n\n    const dataUrl = await chrome.tabs.captureVisibleTab(tab.windowId, {\n      format: options.format || 'jpeg',\n      quality: options.quality || 80\n    })\n\n    return { success: true, dataUrl }\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Screenshot capture failed'\n    }\n  }\n}\n\nasync function getCurrentTab(): Promise<chrome.tabs.Tab | null> {\n  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true })\n  return tab || null\n}\n\n// Set side panel behavior - open on action click\nchrome.sidePanel.setPanelBehavior({ openPanelOnActionClick: true })\n  .catch((error) => console.error('Failed to set panel behavior:', error))\n\nconsole.log('SideVault background service worker initialized')\n"],"names":["tab","message","sender","sendResponse","handleScreenshotCapture","result","error","getCurrentTab","command","tabId","options"],"mappings":"AAGA,OAAO,OAAO,UAAU,YAAY,MAAOA,GAAQ,CAC7CA,EAAI,IACN,MAAM,OAAO,UAAU,KAAK,CAAE,MAAOA,EAAI,GAAI,CAEjD,CAAC,EAGD,OAAO,QAAQ,UAAU,YAAY,CAACC,EAASC,EAAQC,IACjDF,EAAQ,OAAS,sBACnBG,EAAwBH,EAAQ,MAAOA,EAAQ,OAAO,EACnD,KAAKI,GAAUF,EAAaE,CAAM,CAAC,EACnC,MAAMC,GAASH,EAAa,CAAE,QAAS,GAAO,MAAOG,EAAM,OAAA,CAAS,CAAC,EACjE,IAGLL,EAAQ,OAAS,mBACnBM,EAAA,EACG,KAAKP,GAAOG,EAAa,CAAE,QAAS,GAAM,IAAAH,EAAK,CAAC,EAChD,MAAMM,GAASH,EAAa,CAAE,QAAS,GAAO,MAAOG,EAAM,OAAA,CAAS,CAAC,EACjE,IAGF,EACR,EAGD,OAAO,SAAS,UAAU,YAAY,MAAOE,GAAY,CACvD,GAAIA,IAAY,oBAAqB,CACnC,KAAM,CAACR,CAAG,EAAI,MAAM,OAAO,KAAK,MAAM,CAAE,OAAQ,GAAM,cAAe,EAAA,CAAM,EACvEA,GAAA,MAAAA,EAAK,KAEP,MAAM,OAAO,UAAU,KAAK,CAAE,MAAOA,EAAI,GAAI,EAE7C,WAAW,IAAM,CACf,OAAO,QAAQ,YAAY,CAAE,KAAM,eAAgB,IAAAA,EAAK,CAC1D,EAAG,GAAG,EAEV,CACF,CAAC,EAED,eAAeI,EACbK,EACAC,EACiE,CACjE,GAAI,CACF,MAAMV,EAAM,MAAM,OAAO,KAAK,IAAIS,CAAK,EACvC,GAAI,CAACT,EAAI,SACP,MAAM,IAAI,MAAM,sBAAsB,EAQxC,MAAO,CAAE,QAAS,GAAM,QALR,MAAM,OAAO,KAAK,kBAAkBA,EAAI,SAAU,CAChE,OAAQU,EAAQ,QAAU,OAC1B,QAASA,EAAQ,SAAW,EAAA,CAC7B,CAEuB,CAC1B,OAASJ,EAAO,CACd,MAAO,CACL,QAAS,GACT,MAAOA,aAAiB,MAAQA,EAAM,QAAU,2BAAA,CAEpD,CACF,CAEA,eAAeC,GAAiD,CAC9D,KAAM,CAACP,CAAG,EAAI,MAAM,OAAO,KAAK,MAAM,CAAE,OAAQ,GAAM,cAAe,EAAA,CAAM,EAC3E,OAAOA,GAAO,IAChB,CAGA,OAAO,UAAU,iBAAiB,CAAE,uBAAwB,GAAM,EAC/D,MAAOM,GAAU,QAAQ,MAAM,gCAAiCA,CAAK,CAAC,EAEzE,QAAQ,IAAI,iDAAiD"}